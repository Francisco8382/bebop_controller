\hypertarget{gazebo_8py_source}{}\doxysection{gazebo.\+py}
\label{gazebo_8py_source}\index{C:/Users/franc/Desktop/Ubuntu/bebop\_controller/src/bebop\_controller/scripts/gazebo.py@{C:/Users/franc/Desktop/Ubuntu/bebop\_controller/src/bebop\_controller/scripts/gazebo.py}}
\mbox{\hyperlink{gazebo_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00001}00001 \textcolor{comment}{\#!/usr/bin/env python}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00003}00003 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00009}00009 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00010}00010 \textcolor{keyword}{from} subprocess \textcolor{keyword}{import} PIPE, Popen}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00011}00011 \textcolor{keyword}{from} threading  \textcolor{keyword}{import} Thread}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00012}00012 \textcolor{keyword}{import} sys}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00013}00013 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00014}00014 \textcolor{keyword}{import} re}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00015}00015 \textcolor{keyword}{from} queue \textcolor{keyword}{import} Queue, Empty}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00016}00016 \textcolor{keyword}{import} rospy}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00017}00017 \textcolor{keyword}{from} geometry\_msgs.msg \textcolor{keyword}{import} PoseStamped}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00018}00018 \textcolor{keyword}{from} tf.transformations \textcolor{keyword}{import} quaternion\_from\_euler}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00021}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher}{00021}} \textcolor{keyword}{class }\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher}{SphinxPublisher}}:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00022}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a16d24bfd6f22cd16133ea5569b904cd4}{00022}}     \textcolor{keyword}{def }\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a16d24bfd6f22cd16133ea5569b904cd4}{\_\_init\_\_}}(self):}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00023}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_af5208e1785a2f99eeb6ed62725ecd964}{00023}}         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_af5208e1785a2f99eeb6ed62725ecd964}{q}} = Queue()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00024}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{00024}}         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}} = np.zeros(3)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00025}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{00025}}         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}} = np.zeros(3)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00026}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a8ad435724076f0a3512fcd377c349de1}{00026}}         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a8ad435724076f0a3512fcd377c349de1}{cont}} = 1}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00028}00028         \textcolor{comment}{\# Run the command}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00029}00029         ON\_POSIX = \textcolor{stringliteral}{'posix'} \textcolor{keywordflow}{in} sys.builtin\_module\_names}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00030}00030         command = \textcolor{stringliteral}{"{}tlm-\/data-\/logger -\/r 0 inet:127.0.0.1:9060"{}}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00031}00031         p = Popen(command, stdout=PIPE, bufsize=1, close\_fds=ON\_POSIX, shell=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00032}00032         }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00033}00033         \textcolor{comment}{\# Create a thread which dies with main program}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00034}00034         t = Thread(target=self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a57135efdd33025e25865749a90e9b380}{process\_output}}, args=(p.stdout, self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_af5208e1785a2f99eeb6ed62725ecd964}{q}}))}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00035}00035         t.daemon = \textcolor{keyword}{True} }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00036}00036         t.start()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00037}00037         Topic = rospy.get\_param(\textcolor{stringliteral}{'\string~Topic'})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00038}00038         GazeboRealTime = rospy.get\_param(\textcolor{stringliteral}{'\string~GazeboRealTime'})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00039}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a784c27402d24814bc4bda32111f29d9f}{00039}}         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a784c27402d24814bc4bda32111f29d9f}{odom\_pub}} = rospy.Publisher(Topic, PoseStamped, queue\_size=10)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00040}00040         Period = 1.0/(120.0*GazeboRealTime)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00041}00041         rospy.Timer(rospy.Duration(Period), self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a84b7c44af45d8e1ed33b3bad6e9f2e48}{publish}})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00042}00042         rospy.spin() }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00043}00043 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00044}00044     }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00045}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a57135efdd33025e25865749a90e9b380}{00045}}     \textcolor{keyword}{def }\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a57135efdd33025e25865749a90e9b380}{process\_output}}(self, out, queue):}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00046}00046         \textcolor{keywordflow}{for} line \textcolor{keywordflow}{in} iter(out.readline, b\textcolor{stringliteral}{''}):}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00047}00047             line = str(line)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00048}00048             \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.worldPosition"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00049}00049                 number = re.findall(\textcolor{stringliteral}{r"{}[-\/+]?\(\backslash\)d*\(\backslash\).\(\backslash\)d+"{}}, line)[0]}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00050}00050                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.x"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00051}00051                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[0] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00052}00052                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.y"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00053}00053                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[1] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00054}00054                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.z"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00055}00055                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[2] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00058}00058             \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.worldAttitude"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00059}00059                 number = re.findall(\textcolor{stringliteral}{r"{}[-\/+]?\(\backslash\)d*\(\backslash\).\(\backslash\)d+"{}}, line)[0]}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00060}00060                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.x"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00061}00061                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[0] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00062}00062                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.y"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00063}00063                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[1] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00064}00064                 \textcolor{keywordflow}{if} \textcolor{stringliteral}{"{}.z"{}} \textcolor{keywordflow}{in} line:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00065}00065                     self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[2] = float(number)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00066}00066                     }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00067}00067             queue.put(line)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00068}00068         out.close()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00070}00070     }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00071}\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a84b7c44af45d8e1ed33b3bad6e9f2e48}{00071}}     \textcolor{keyword}{def }\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a84b7c44af45d8e1ed33b3bad6e9f2e48}{publish}}(self,event):}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00072}00072         \textcolor{keywordflow}{try}:  }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00073}00073             line = self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_af5208e1785a2f99eeb6ed62725ecd964}{q}}.get\_nowait()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00074}00074         \textcolor{keywordflow}{except} Empty:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00075}00075             self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_af5208e1785a2f99eeb6ed62725ecd964}{q}}.queue.clear()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00076}00076         qx, qy, qz, qw = quaternion\_from\_euler(self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[0], self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[1], self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a5007bc07857f0a5de6d450bf1d969794}{att}}[2], \textcolor{stringliteral}{'sxyz'})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00077}00077         pose = PoseStamped()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00078}00078         pose.header.seq = self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a8ad435724076f0a3512fcd377c349de1}{cont}}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00079}00079         pose.header.stamp = rospy.Time.now()}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00080}00080         pose.header.frame\_id = \textcolor{stringliteral}{"{}bebop2"{}}}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00081}00081         pose.pose.position.x = self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[1]}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00082}00082         pose.pose.position.y = self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[2]}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00083}00083         pose.pose.position.z = self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_ab07c20538d3cbc0e618316e955255238}{pos}}[0]}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00084}00084         pose.pose.orientation.x = qy}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00085}00085         pose.pose.orientation.y = qz}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00086}00086         pose.pose.orientation.z = qx}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00087}00087         pose.pose.orientation.w = qw}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00088}00088         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a8ad435724076f0a3512fcd377c349de1}{cont}} += 1}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00089}00089         self.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a784c27402d24814bc4bda32111f29d9f}{odom\_pub}}.\mbox{\hyperlink{classgazebo_1_1_sphinx_publisher_a84b7c44af45d8e1ed33b3bad6e9f2e48}{publish}}(pose)}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00091}00091 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00092}00092     rospy.init\_node(\textcolor{stringliteral}{'SphinxPublisher'})}
\DoxyCodeLine{\Hypertarget{gazebo_8py_source_l00093}00093     publisher = \mbox{\hyperlink{classgazebo_1_1_sphinx_publisher}{SphinxPublisher}}()}

\end{DoxyCode}
